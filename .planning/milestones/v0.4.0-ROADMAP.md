# Milestone v0.4.0: GEE Extension

**Status:** SHIPPED 2026-02-08
**Phases:** 5-7
**Total Plans:** 4

## Overview

v0.4.0 extends beeca to accept GEE objects (glmgee from glmtoolbox, geeglm from geepack) for single-timepoint covariate-adjusted binary endpoint analysis. The work is surgical: add S3 validation methods, route variance estimation to GEE's own vcov, verify the existing pipeline flows through, then validate with tests and documentation. Three phases deliver the complete capability: core implementation, testing, and documentation.

## Phases

### Phase 5: GEE Core Implementation

**Goal**: GEE objects (glmgee and geeglm) flow through beeca's full pipeline and produce correct marginal treatment effect estimates with robust variance
**Depends on**: Phase 4 (v0.3.0 shipped)
**Requirements**: VALID-01, VALID-02, VALID-03, VAR-01, VAR-02, VAR-03, VAR-04, VAR-05, PIPE-01, PIPE-02, PIPE-03, PIPE-04
**Plans**: 2 plans

Plans:
- [x] 05-01-PLAN.md -- S3 validation methods for glmgee and geeglm (sanitize_model + DESCRIPTION)
- [x] 05-02-PLAN.md -- GEE variance routing and end-to-end pipeline verification

**Details:**
- sanitize_model.glmgee (83 lines) and sanitize_model.geeglm (73 lines) with 9 validation checks each
- varcov_ge_gee (64 lines) implements GEE-specific delta method using GEE's own vcov()
- Ye method early rejection with locked error message
- GEE type default: HC0 auto-resolves to "robust"
- Matrix-to-vector fix for GEE predict output in predict_counterfactuals
- .get_formula() helper with fallback chain for robust formula extraction
- glmtoolbox and geepack added to Suggests (not Imports)

### Phase 6: GEE Testing

**Goal**: GEE functionality is validated by a comprehensive test suite, existing GLM functionality has no regressions, and the package passes R CMD check
**Depends on**: Phase 5
**Requirements**: TEST-01, TEST-02, TEST-03
**Plans**: 1 plan

Plans:
- [x] 06-01-PLAN.md -- Comprehensive GEE test suite with manual delta method cross-validation and R CMD check

**Details:**
- test-gee.R: 471 lines, 19 test blocks, 60 assertions
- Manual delta method cross-validation (V = D * V_beta * D^T) for both glmgee and geeglm
- Cross-validated to 1e-10 tolerance against Ge et al (2011) formula
- 368 total tests (308 baseline + 60 new), 0 failures, 0 regressions
- R CMD check: 0 errors, 0 warnings, 2 acceptable notes

### Phase 7: GEE Documentation

**Goal**: Users can discover and use beeca's GEE support through a vignette, updated man pages, and release notes
**Depends on**: Phase 6
**Requirements**: DOC-01, DOC-02, DOC-03
**Plans**: 1 plan

Plans:
- [x] 07-01-PLAN.md -- GEE vignette, roxygen man page updates, NEWS.md v0.4.0, pkgdown config

**Details:**
- vignettes/gee-workflow.Rmd (190 lines) with complete glmgee and geeglm workflows
- Eval guards for optional GEE package dependencies
- get_marginal_effect.Rd and estimate_varcov.Rd document GEE object types and variance types
- NEWS.md v0.4.0 section with New Features and Documentation subsections
- _pkgdown.yml updated with "GEE Extension" article section

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**

- GEE Option A (minimal, single-timepoint): Preserves beeca identity, feasibility confirmed
- Ye method excluded for GEE: Assumes independence, not valid for correlated data
- GEE packages in Suggests (not Imports): Keep beeca lightweight, GEE is optional
- Fail-fast package availability check with install hints
- Single-timepoint validation via cluster size = 1 requirement
- GEE default variance type is "robust" (maps from HC0)
- geeglm: robust only (native geepack sandwich SE)
- glmgee: robust, bias-corrected, df-adjusted (matches glmtoolbox vcov API)
- Use vcov() method call instead of object internals
- Manual delta method cross-validation for independent correctness verification

**Issues Resolved:**

- GEE predict matrix output causing duplicate column names (auto-fixed in predict_counterfactuals)
- Undeclared tibble import in tests (replaced with inherits() base R check)
- Attribute mismatch in variance comparison (use matrix indexing for value-only comparison)

**Issues Deferred:**

- Multi-timepoint longitudinal GEE (requires companion package beecal)
- gee package support (older package, lower priority)
- ARD improvements (deferred to v0.5.0 milestone)
- beeca_to_cards_ard() test coverage (deferred from v0.3.0, still pending)

**Technical Debt Incurred:**

- beeca_to_cards_ard() still has 0% test coverage (carried from v0.3.0)

---

_For current project status, see .planning/PROJECT.md_
