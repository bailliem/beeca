---
phase: 01-build-validation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "R CMD check completes with 0 errors"
    - "R CMD check completes with 0 warnings (or acceptable ones documented)"
    - "All testthat tests pass"
    - "Any acceptable NOTEs or gaps are documented"
  artifacts:
    - path: ".planning/phases/01-build-validation/01-VALIDATION-FINAL.md"
      provides: "Final validation status and any documented exceptions"
  key_links:
    - from: "01-CHECK-RESULTS.md"
      to: "01-VALIDATION-FINAL.md"
      via: "Issue triage and fixes"
---

<objective>
Review validation results, triage any issues with user, fix blockers, and document final validation status.

Purpose: Ensure Phase 1 success criteria are met - package builds cleanly for v0.3.0 release.
Output: Either clean validation status OR documented fixes applied and final clean validation.
</objective>

<execution_context>
@/Users/bailliem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bailliem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-build-validation/01-CONTEXT.md
@.planning/phases/01-build-validation/01-CHECK-RESULTS.md
@.planning/phases/01-build-validation/01-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:decision" gate="blocking">
  <name>Task 1: Triage validation issues</name>
  <decision>Review validation results and decide what to fix vs document as acceptable</decision>
  <context>
Based on 01-CHECK-RESULTS.md from Plan 01:

**Per Phase Context decisions:**
- Errors: Must be fixed (blockers)
- Warnings: Evaluate severity - fix critical ones, document acceptable ones
- NOTEs: Document only, don't block release
- Test failures: Evaluate each - fix real failures, document flaky tests
- Coverage gaps: Document only for awareness (no target required)

User decides what blocks release.
  </context>
  <how-to-review>
1. Read .planning/phases/01-build-validation/01-CHECK-RESULTS.md
2. For each issue listed, decide:
   - FIX: Issue must be resolved before release
   - ACCEPT: Issue is acceptable, document why
   - INVESTIGATE: Need more info before deciding
  </how-to-review>
  <resume-signal>
Provide triage decisions in format:
- Issue X: FIX (reason)
- Issue Y: ACCEPT (reason)
- Issue Z: INVESTIGATE (what to check)

Or if no issues: "All clean - proceed to finalize"
  </resume-signal>
</task>

<task type="auto">
  <name>Task 2: Apply fixes for triaged issues</name>
  <files>Expected: 1-5 files across R/ and tests/testthat/. If more than 5 files need changes, escalate to user for scope decision.</files>
  <action>
For each issue marked FIX in triage:

**Scope limits:**
- Apply up to 3 simple fixes in this task
- If more than 3 FIX items exist, prioritize by severity (errors first, then warnings, then test failures)
- If any single fix requires changes to more than 2 files, escalate to user before proceeding
- Complex fixes (architectural changes, new dependencies, major refactoring) should be escalated rather than attempted

1. Identify the root cause from check/test output
2. Apply minimal fix to resolve the issue
3. Document what was changed and why

Common R CMD check fixes:
- Missing imports: Add to NAMESPACE via roxygen @importFrom
- Undocumented parameters: Add @param in roxygen
- Examples that fail: Fix example code or add \dontrun{}
- Missing dependencies: Add to DESCRIPTION Imports/Suggests

Common test fixes:
- Failing assertions: Fix test expectation or underlying code
- Missing test data: Ensure fixtures are available
- Environment issues: Add skip_on_cran() or skip_if() conditions

**Escalation triggers (pause and ask user):**
- More than 3 FIX items remain after initial fixes
- Any fix touches more than 2 files
- Fix requires architectural changes or new dependencies
- Unclear how to fix without deeper investigation

If no issues marked FIX, skip this task.
  </action>
  <verify>
Re-run the specific check or test that failed to confirm fix works.
  </verify>
  <done>
All FIX items are resolved (up to 3), or task was skipped because no fixes needed, or user was asked about remaining/complex issues.
  </done>
</task>

<task type="auto">
  <name>Task 3: Re-run validation and finalize</name>
  <files>.planning/phases/01-build-validation/01-VALIDATION-FINAL.md</files>
  <action>
1. If fixes were applied, re-run R CMD check and testthat:
   ```r
   Rscript -e "devtools::check(error_on = 'never')"
   Rscript -e "devtools::test()"
   ```

2. Create `.planning/phases/01-build-validation/01-VALIDATION-FINAL.md` with:

   ## Final Validation Status

   **Date:** [date]
   **Package Version:** 0.3.0

   ### R CMD check
   - Errors: 0
   - Warnings: [count]
   - Notes: [count]

   ### testthat
   - Tests: [total]
   - Passed: [count]
   - Failed: 0
   - Skipped: [count]

   ### Test Coverage
   - Overall: [percentage]%
   - Gaps documented: [list or "None"]

   ### Accepted Items (if any)
   [List any warnings/notes documented as acceptable per triage]

   ### Fixes Applied (if any)
   [List what was fixed and why]

   ### Phase 1 Success Criteria
   - [x] R CMD check: 0 errors
   - [x] R CMD check: 0 warnings (or acceptable ones documented)
   - [x] All testthat tests pass
   - [x] Coverage gaps documented (if any)

   **STATUS: PHASE 1 COMPLETE**

3. If validation still shows issues after fixes, note them for user escalation.
  </action>
  <verify>
01-VALIDATION-FINAL.md exists and shows all Phase 1 success criteria met (or escalation needed).
  </verify>
  <done>
Final validation status documented. Phase 1 success criteria verified.
  </done>
</task>

</tasks>

<verification>
- [ ] Triage decisions made by user
- [ ] All FIX items resolved (or none needed, or escalated)
- [ ] Final validation run completed
- [ ] 01-VALIDATION-FINAL.md documents final status
- [ ] Phase 1 success criteria met
</verification>

<success_criteria>
- R CMD check: 0 errors, 0 warnings (or acceptable ones documented)
- testthat: All tests pass
- Any exceptions properly documented with rationale
- 01-VALIDATION-FINAL.md confirms Phase 1 complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-build-validation/01-02-SUMMARY.md`
</output>
