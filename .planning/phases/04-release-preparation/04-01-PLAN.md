---
phase: 04-release-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - NEWS.md
  - R/estimate_varcov.R
  - R/get_marginal_effect.R
autonomous: true

must_haves:
  truths:
    - "NEWS.md follows tidyverse style with sections: New Features, Improvements, Bug Fixes"
    - "Each NEWS.md bullet is a one-liner with function name in backticks early"
    - "trial02_cdisc dataset explicitly mentioned in NEWS.md"
    - "Magirr et al. reference update noted in NEWS.md"
    - "No OSF preprint URLs remain in R/ source files"
  artifacts:
    - path: "NEWS.md"
      provides: "Complete v0.3.0 changelog in tidyverse style"
      contains: "trial02_cdisc"
    - path: "R/estimate_varcov.R"
      provides: "Updated Magirr reference with DOI"
      contains: "10.1002/pst.70021"
    - path: "R/get_marginal_effect.R"
      provides: "Updated Magirr reference with DOI"
      contains: "10.1002/pst.70021"
  key_links:
    - from: "NEWS.md"
      to: "DESCRIPTION"
      via: "Version number match"
      pattern: "beeca 0\\.3\\.0"
---

<objective>
Restructure NEWS.md to tidyverse style and update remaining OSF preprint references to published DOI.

Purpose: NEWS.md is the user-facing changelog for v0.3.0. It must be clear, scannable, and complete. Two R source files still reference the OSF preprint that has been published — these must be updated to the DOI before release.

Output: Restructured NEWS.md with tidyverse-style sections and one-liner bullets; updated roxygen comments in estimate_varcov.R and get_marginal_effect.R with published DOI.
</objective>

<execution_context>
@/Users/bailliem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bailliem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-release-preparation/04-CONTEXT.md
@.planning/phases/04-release-preparation/04-RESEARCH.md
@NEWS.md
@DESCRIPTION
@R/estimate_varcov.R
@R/get_marginal_effect.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure NEWS.md to tidyverse style</name>
  <files>NEWS.md</files>
  <action>
Rewrite the beeca 0.3.0 section of NEWS.md following tidyverse conventions. Keep the older version entries (0.2.0, 0.1.3, 0.1.0) unchanged.

Structure for v0.3.0:

```markdown
# beeca 0.3.0

## New Features

* `beeca_fit()`: Convenience function combining model fitting and marginal effect estimation in a single call.
* `plot_forest()`: Forest plots for visualizing treatment effects with customizable confidence levels and styling.
* `plot.beeca()`: S3 plot method for beeca objects.
* `beeca_summary_table()`: Generate summary tables from beeca objects using gt.
* `beeca_to_cards_ard()`: Convert beeca results to Analysis Results Data format via cards.
* `tidy.beeca()`: Tidy method returning treatment effect estimates as a tibble.
* `augment.beeca()`: Augment method returning original data with fitted values.
* `print.beeca()`: Concise print output showing treatment effect, standard error, Z-value, and p-value.
* `summary.beeca()`: Comprehensive summary including marginal risks and treatment effects with confidence intervals.
* `trial02_cdisc`: CDISC-compliant example dataset for clinical trial workflows.

## Improvements

* Updated Magirr et al. reference from OSF preprint to published version in Pharmaceutical Statistics (2025).
* Added `rlang` and `generics` to package Imports for robust non-standard evaluation and S3 method support.
* Added Suggests dependencies for enhanced visualization (`ggplot2`) and table formatting (`gt`, `cards`).
* Enhanced vignettes with improved narrative flow, cross-referencing, and method guidance.

## Bug Fixes

* Fixed function name conflict in `plot_forest()` where base R's `diff()` was called incorrectly.
```

Key style rules from CONTEXT.md decisions (LOCKED):
- Sections: "New Features", "Improvements", "Bug Fixes" (standard R convention, like tidyverse)
- One-liner per function (not multi-bullet descriptions)
- Function names in backticks with parentheses
- Audience: pharma statisticians AND R developers
- trial02_cdisc as explicit bullet (decision from CONTEXT.md)
- Magirr et al. reference update noted (decision from CONTEXT.md)
- No acknowledgments section (decision from CONTEXT.md)
- Use `*` bullets (tidyverse convention), end with period

Note: `beeca_summary_table()`, `beeca_to_cards_ard()`, `tidy.beeca()`, `augment.beeca()` — verify these exist in R/ before including. If any do not exist as exported functions, omit them.
  </action>
  <verify>
Read NEWS.md and confirm:
1. v0.3.0 section has exactly 3 subsections: New Features, Improvements, Bug Fixes
2. Each bullet is a single line starting with `*`
3. Function names appear in backticks with parentheses
4. trial02_cdisc mentioned
5. Magirr et al. reference update mentioned
6. Older version entries (0.2.0, 0.1.3, 0.1.0) unchanged
  </verify>
  <done>NEWS.md has tidyverse-style changelog for v0.3.0 with one-liner bullets, all required content items present, older versions preserved</done>
</task>

<task type="auto">
  <name>Task 2: Update OSF preprint references to published DOI</name>
  <files>R/estimate_varcov.R, R/get_marginal_effect.R</files>
  <action>
In both files, find the roxygen comment referencing the OSF preprint and update to the published DOI.

**R/estimate_varcov.R** (line ~23):
- Find: `#' For more details, see [Magirr et al. (2024)](https://osf.io/9mp58/).`
- Replace with: `#' For more details, see Magirr et al. (2025) \doi{10.1002/pst.70021}.`

**R/get_marginal_effect.R** (line ~30):
- Find: `#' For more details, see [Magirr et al. (2024)](https://osf.io/9mp58/).`
- Replace with: `#' For more details, see Magirr et al. (2025) \doi{10.1002/pst.70021}.`

After editing the roxygen comments, run `devtools::document()` to regenerate the corresponding man pages (man/estimate_varcov.Rd and man/get_marginal_effect.Rd) so the .Rd files reflect the DOI update.

Important: Use roxygen2's `\doi{}` tag which renders as a clickable DOI link in help pages. Do NOT use markdown link syntax `[text](url)` for DOIs in roxygen — use `\doi{10.1002/pst.70021}`.
  </action>
  <verify>
1. `grep -r "osf.io/9mp58" R/` returns zero matches
2. `grep -r "10.1002/pst.70021" R/estimate_varcov.R R/get_marginal_effect.R` returns matches in both files
3. `grep -r "10.1002/pst.70021" man/estimate_varcov.Rd man/get_marginal_effect.Rd` returns matches in both man pages
4. No OSF URLs remain in any R/ source file
  </verify>
  <done>Both R source files and their generated man pages reference the published DOI instead of OSF preprint</done>
</task>

</tasks>

<verification>
1. NEWS.md v0.3.0 section uses tidyverse style (3 sections, one-liner bullets, backtick function names)
2. Zero OSF preprint references in R/ directory: `grep -r "osf.io" R/` returns nothing
3. DOI present in both updated files: `grep -r "10.1002/pst.70021" R/estimate_varcov.R R/get_marginal_effect.R`
4. Man pages regenerated with DOI: `grep "10.1002/pst.70021" man/estimate_varcov.Rd man/get_marginal_effect.Rd`
5. Version in NEWS.md header matches DESCRIPTION: both show 0.3.0
</verification>

<success_criteria>
- NEWS.md restructured with New Features, Improvements, Bug Fixes sections
- All bullets are one-liners with function names in backticks
- trial02_cdisc dataset documented in NEWS.md
- Magirr et al. reference update noted in NEWS.md
- Zero OSF preprint URLs in R/ source files
- Man pages regenerated with published DOI
</success_criteria>

<output>
After completion, create `.planning/phases/04-release-preparation/04-01-SUMMARY.md`
</output>
