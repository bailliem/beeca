---
phase: 04-release-preparation
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "R CMD check passes with 0 errors and 0 warnings on release branch"
    - "pkgdown site builds without errors on release branch"
    - "All URLs in package documentation are reachable"
    - ".Rbuildignore excludes .planning/ and .claude/ from source tarball"
    - "DESCRIPTION version is 0.3.0"
    - "release/v0.3.0 branch exists and is pushed to origin"
  artifacts:
    - path: "release/v0.3.0 (git branch)"
      provides: "Release branch ready for user to tag"
  key_links:
    - from: "NEWS.md"
      to: "DESCRIPTION"
      via: "Version number consistency"
      pattern: "0\\.3\\.0"
    - from: ".Rbuildignore"
      to: "source tarball"
      via: "Exclusion patterns"
      pattern: "\\.planning|\\.claude"
---

<objective>
Create release branch, run full pre-release validation suite, and verify package is ready for v0.3.0 tagging.

Purpose: The release branch isolates the v0.3.0 release from ongoing main branch development. Full validation (R CMD check, URL checks, pkgdown build, .Rbuildignore verification) on this branch confirms the package is release-ready. The user will manually tag after reviewing results.

Output: release/v0.3.0 branch pushed to origin, validation results confirming 0 errors/0 warnings, pkgdown builds clean, URLs valid.
</objective>

<execution_context>
@/Users/bailliem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bailliem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-release-preparation/04-CONTEXT.md
@.planning/phases/04-release-preparation/04-RESEARCH.md
@.Rbuildignore
@DESCRIPTION
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create release branch and run validation suite</name>
  <files>(no files modified — validation only + branch creation)</files>
  <action>
**Step 1: Create release branch from main**

```bash
cd /Users/bailliem/R-projects/beeca-feb3
git checkout main
git checkout -b release/v0.3.0
```

**Step 2: Verify DESCRIPTION metadata**

Read DESCRIPTION and confirm:
- Version: 0.3.0 (should already be set)
- All Imports and Suggests are correct
- URLs are present and well-formed

**Step 3: Run R CMD check with CRAN settings**

```r
devtools::check(cran = TRUE)
```

REQUIRED: 0 errors, 0 warnings. Notes are acceptable if informational.

If errors or warnings found: fix on release branch, commit fixes, re-run check. Do NOT merge fixes back to main in this plan — that's a separate step.

**Step 4: Run URL validation**

```r
urlchecker::url_check()
```

If urlchecker is not installed, install it first: `install.packages("urlchecker")`

Fix any broken or redirected URLs found. Common issues:
- HTTP -> HTTPS redirects (update to HTTPS)
- OSF URLs that should now be DOIs (should be fixed by Plan 01)
- Moved documentation pages

**Step 5: Verify pkgdown site builds**

```r
pkgdown::build_site()
```

REQUIRED: No errors during build. Warnings about missing articles are acceptable if they reference articles/ directory.

**Step 6: Verify .Rbuildignore excludes non-package files**

```r
# Build source tarball
pkg_tarball <- pkgbuild::build()

# Check contents for unwanted files
contents <- system(paste("tar -tzf", pkg_tarball), intern = TRUE)

# These patterns must NOT appear
unwanted <- c(".planning", ".claude", "CLAUDE.MD", "CLAUDE.md", "ENHANCEMENTS.md", "IMPLEMENTATION_PLAN.md")
for (pattern in unwanted) {
  matches <- grep(pattern, contents, value = TRUE)
  if (length(matches) > 0) {
    message("WARNING: Found ", pattern, " in tarball")
  }
}

# Clean up
unlink(pkg_tarball)
```

If unwanted files found: update .Rbuildignore, rebuild, verify again.

**Step 7: Commit any validation fixes on release branch**

If any fixes were needed during validation:
```bash
git add -A
git commit -m "fix(04): address pre-release validation findings"
```

**Step 8: Push release branch**

```bash
git push -u origin release/v0.3.0
```

Note: Do NOT create a tag. The user will tag manually after reviewing.
  </action>
  <verify>
1. `git branch` shows release/v0.3.0 as current branch
2. R CMD check output shows 0 errors, 0 warnings
3. pkgdown::build_site() completed without error
4. urlchecker::url_check() shows no broken URLs
5. Source tarball does not contain .planning/ or .claude/ directories
6. `git log --oneline -3` shows commits on release branch
  </verify>
  <done>Release branch exists with all validation passing: 0 errors, 0 warnings from R CMD check; pkgdown builds clean; URLs valid; .Rbuildignore verified</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Release branch release/v0.3.0 created from main with:
- Restructured NEWS.md (tidyverse style)
- Updated OSF references to published DOI
- Full validation suite passed (R CMD check, URL check, pkgdown build)
- .Rbuildignore verified
- Branch pushed to origin
  </what-built>
  <how-to-verify>
1. Review NEWS.md on release branch — confirm changelog is accurate and complete
2. Review R CMD check results — confirm 0 errors, 0 warnings
3. Review pkgdown site in docs/ — spot-check a few pages render correctly
4. Confirm you're ready to tag: `git tag -a v0.3.0 -m "Release v0.3.0" && git push origin v0.3.0`
  </how-to-verify>
  <resume-signal>Type "approved" to confirm release is ready, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. release/v0.3.0 branch exists: `git branch -a | grep release`
2. R CMD check: 0 errors, 0 warnings
3. pkgdown: builds without error
4. URLs: all reachable (urlchecker clean)
5. Tarball: no .planning/ or .claude/ files
6. DESCRIPTION Version matches NEWS.md header: both 0.3.0
7. No lifecycle deprecations to document (confirmed in research)
</verification>

<success_criteria>
- release/v0.3.0 branch created and pushed to origin
- R CMD check passes with 0 errors, 0 warnings
- pkgdown site builds cleanly
- All URLs in documentation are valid
- .Rbuildignore properly excludes non-package files
- User has reviewed and approved the release
</success_criteria>

<output>
After completion, create `.planning/phases/04-release-preparation/04-02-SUMMARY.md`
</output>
