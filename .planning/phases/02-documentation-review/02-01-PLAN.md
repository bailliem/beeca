---
phase: 02-documentation-review
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - R/estimate_varcov.R
  - R/apply_contrast.R
  - R/predict_counterfactuals.R
  - R/average_predictions.R
  - R/get_marginal_effect.R
  - R/beeca_fit.R
  - R/as_gt.R
  - R/augment.R
  - R/plot_forest.R
  - R/plot.R
  - R/print.R
  - R/summary.R
  - R/tidy.R
  - R/beeca_to_cards_ard.R
  - R/sanitize.R
  - R/beeca-package.R
  - R/reexports.R
  - DESCRIPTION
autonomous: true

must_haves:
  truths:
    - "All exported functions have complete roxygen2 blocks with @description, @param, @return, @examples, @references (where applicable), and @seealso"
    - "All @examples execute without error (no broken examples hidden behind \\dontrun{})"
    - "All @references include complete citations with resolving DOIs"
    - "DESCRIPTION metadata is accurate for v0.3.0 (authors, URLs, dependencies, version constraints)"
  artifacts:
    - path: "R/estimate_varcov.R"
      provides: "Standardized references with DOIs for Ge and Ye methods"
    - path: "DESCRIPTION"
      provides: "Audited v0.3.0 metadata"
  key_links:
    - from: "R/*.R (roxygen2)"
      to: "man/*.Rd"
      via: "devtools::document()"
      pattern: "@seealso.*\\[.*\\(\\)\\]"
---

<objective>
Review and standardize all man page documentation across the beeca package, audit DESCRIPTION metadata, and ensure all roxygen2 documentation meets v0.3.0 quality standards.

Purpose: DOCS-02 requirement — all exported functions must have complete, accurate man pages. DESCRIPTION audit ensures metadata is correct for release.
Output: Standardized roxygen2 documentation across all R source files, audited DESCRIPTION, regenerated man pages.
</objective>

<execution_context>
@/Users/bailliem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bailliem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-documentation-review/02-CONTEXT.md
@.planning/phases/02-documentation-review/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Standardize roxygen2 documentation across all R source files</name>
  <files>
    R/estimate_varcov.R
    R/apply_contrast.R
    R/predict_counterfactuals.R
    R/average_predictions.R
    R/get_marginal_effect.R
    R/beeca_fit.R
    R/as_gt.R
    R/augment.R
    R/plot_forest.R
    R/plot.R
    R/print.R
    R/summary.R
    R/tidy.R
    R/beeca_to_cards_ard.R
    R/sanitize.R
    R/beeca-package.R
    R/reexports.R
  </files>
  <action>
    Systematically review ALL roxygen2 documentation blocks in the R/ directory. For each file:

    1. **@references standardization**: Ensure all citations use the format:
       `Author, A. et al. (Year). "Title." *Journal* Volume(Issue): Pages. <https://doi.org/DOI>`
       Key citations to verify/fix:
       - Ge et al. (2011): DOI 10.1177/009286151104500409
       - Ye et al. (2023): DOI 10.1080/24754269.2023.2205802
       - Magirr et al. (2025): DOI 10.1002/pst.70021
       - FDA (2023) guidance URL
       Focus especially on estimate_varcov.R which research identified as having incomplete references.

    2. **@seealso completeness**: Ensure cross-references form a navigable web:
       - Pipeline functions should chain: predict_counterfactuals -> average_predictions -> estimate_varcov -> apply_contrast
       - get_marginal_effect() should link to beeca_fit() and vice versa
       - S3 methods (print, summary, plot, tidy, augment) should cross-reference each other and link to beeca_fit()/get_marginal_effect()
       - Output functions (beeca_summary_table, as_gt, beeca_to_cards_ard, plot_forest) should reference each other
       - Use `[function_name()]` syntax for auto-linking

    3. **\dontrun{} audit**: For functions using \dontrun{} (beeca_fit, as_gt, augment.beeca, beeca_to_cards_ard, plot_forest, plot.beeca):
       - If the example only needs suggested packages (gt, cards, ggplot2), convert to conditional: `if (requireNamespace("pkg", quietly = TRUE)) { ... }`
       - If the example can run with base packages + beeca only, remove \dontrun{} entirely
       - Only keep \dontrun{} for examples that truly cannot run in check (e.g., external services)

    4. **@param and @return consistency**: Verify all exported functions have:
       - Complete @param descriptions for every parameter (lowercase start, no trailing period unless multi-sentence)
       - @return section describing return value structure
       - For complex returns (augmented glm objects), use \tabular{} format

    5. After all edits, run `devtools::document()` to regenerate man/ pages.

    Do NOT modify the underlying function logic — documentation only.
  </action>
  <verify>
    Run: `Rscript -e 'devtools::document(); devtools::check(args = c("--no-vignettes", "--no-tests"))'`
    Verify: 0 errors, 0 warnings related to documentation (Rd files, NAMESPACE, examples).
  </verify>
  <done>
    All 25+ man pages have standardized roxygen2 blocks. All @references have complete DOIs. All @seealso form navigable cross-reference chains. \dontrun{} is only used where truly necessary. devtools::document() runs without warnings.
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit and update DESCRIPTION for v0.3.0 accuracy</name>
  <files>DESCRIPTION</files>
  <action>
    Perform a complete DESCRIPTION audit:

    1. **Version**: Confirm Version: 0.3.0 (already set, just verify)

    2. **Authors@R**: Verify all authors listed, roles correct (cre = maintainer, aut = author). Cross-check against README Package authors section.

    3. **Description field**: Verify it accurately describes v0.3.0 capabilities. Should mention marginal treatment effects, binary outcomes, logistic regression, covariate adjustment, and reference the key papers.

    4. **Imports**: Verify all imported packages are actually used in the code (dplyr, generics, lifecycle, rlang, sandwich, stats). Check no missing imports.

    5. **Suggests**: Verify all suggested packages are actually used in tests/vignettes/examples (cards, ggplot2, gt, knitr, marginaleffects, margins, RobinCar >= 0.3.0, rmarkdown, testthat >= 3.0.0, tidyr). Check no missing suggests.

    6. **URL and BugReports**: Verify URLs are correct and resolve.

    7. **License**: Confirm LGPL (>= 3) is correct.

    8. **Depends**: R (>= 2.10) — verify this is still the minimum required version.

    Fix any issues found immediately.
  </action>
  <verify>
    Run: `Rscript -e 'devtools::check(args = c("--no-vignettes", "--no-tests"))'`
    No DESCRIPTION-related warnings or notes.
  </verify>
  <done>
    DESCRIPTION accurately reflects v0.3.0 package metadata. All Imports/Suggests verified against actual usage. URLs resolve correctly. Authors match README.
  </done>
</task>

</tasks>

<verification>
1. `Rscript -e 'devtools::document()'` completes without warnings
2. `Rscript -e 'devtools::run_examples()'` completes without errors (all examples execute)
3. `Rscript -e 'devtools::check(args = c("--no-vignettes", "--no-tests"))'` shows 0 errors, 0 warnings for documentation
4. Spot-check 3 man pages in man/ to verify @references have DOIs and @seealso links are present
</verification>

<success_criteria>
- All 25+ .Rd files regenerated from standardized roxygen2 blocks
- Zero \dontrun{} blocks that could be converted to conditional execution
- All @references have complete citation format with DOIs
- @seealso cross-references form navigable chains across pipeline, S3 methods, and output functions
- DESCRIPTION fully audited for v0.3.0 accuracy
- devtools::document() and example execution produce no errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-documentation-review/02-01-SUMMARY.md`
</output>
